FROM node:24

# Install base tools
RUN apt-get update && apt-get install -y \
    git \
    curl \
    ca-certificates \
    jq \
    bash \
    coreutils \
    procps \
    && rm -rf /var/lib/apt/lists/*

# Create workspace and ensure node owns it
RUN mkdir -p /workspace && chown -R node:node /workspace

# Install Codex CLI globally
RUN npm install -g @openai/codex

# Switch to node user and set defaults
USER node
WORKDIR /workspace

ENV CODEX_HOME=/home/node/.codex
ENV APPIMAGE_EXTRACT_AND_RUN=1
ENV TMPDIR=/workspace

CMD ["codex", "--help"]
